<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Account Manager</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@1.35.6/dist/umd/supabase.min.js"></script>
  <style>
    body { font-family: sans-serif; background: #f0f2f5; padding: 2rem; max-width: 700px; margin: auto; }
    .card { background: white; border-radius: 12px; padding: 1rem; margin-bottom: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .card.inactive { background: #ffe6e6; }
    .chips { display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 1rem 0; }
    .chip { background: #ddd; border-radius: 20px; padding: 0.3rem 0.8rem; cursor: pointer; }
    .chip.active { background: #007bff; color: white; }
    input, textarea, select { width: 100%; margin-top: 0.5rem; padding: 0.5rem; border-radius: 6px; border: 1px solid #ccc; }
    button { padding: 0.5rem 1rem; margin-top: 1rem; border: none; border-radius: 6px; background: #007bff; color: white; cursor: pointer; }
    .search-bar { margin-bottom: 1rem; }
  </style>
</head>
<body>

  <h2>ğŸ” Add New Account</h2>
  <div class="card">
    <label>ğŸŒ Domain</label>
    <input id="domainInput" placeholder="facebook, github...">
    
    <label>ğŸ·ï¸ Category</label>
    <input id="categoryInput" placeholder="à¸‡à¸²à¸™, à¸ªà¹ˆà¸§à¸™à¸•à¸±à¸§, à¸¥à¸¹à¸à¸„à¹‰à¸²...">
    
    <label>ğŸ†” ID</label>
    <input id="idInput" placeholder="username or email">
    
    <label>ğŸ”‘ Password</label>
    <input id="passInput" placeholder="password">
    
    <label>ğŸ“› Account Name</label>
    <input id="nameInput" placeholder="à¸Šà¸·à¹ˆà¸­à¸šà¸±à¸à¸Šà¸µ à¹€à¸Šà¹ˆà¸™ à¸šà¸±à¸à¸Šà¸µà¸«à¸¥à¸±à¸">
    
    <label>ğŸ“ Description</label>
    <textarea id="descInput" rows="2" placeholder="à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”"></textarea>
    
    <label>ğŸ“¶ Status</label>
    <select id="statusInput">
      <option value="active">ğŸŸ¢ à¹ƒà¸Šà¹‰à¸‡à¸²à¸™</option>
      <option value="inactive">ğŸ”´ à¹„à¸¡à¹ˆà¹ƒà¸Šà¹‰à¸‡à¸²à¸™</option>
    </select>
    
    <button onclick="addAccount()">â• Add Account</button>
  </div>

  <h3>ğŸ“ Filter</h3>
  <div class="chips" id="categoryFilters"></div>
  <div class="chips" id="domainFilters"></div>
  <input class="search-bar" type="text" placeholder="ğŸ” à¸„à¹‰à¸™à¸«à¸²..." oninput="filterAccounts()" id="searchInput"/>

  <div id="accountList"></div>

  <script>
    const supabase = supabase.createClient("https://fkntlawaawawiusmjsez.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZrbnRsYXdhYXdhd2l1c21qc2V6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk5ODcxMjAsImV4cCI6MjA2NTU2MzEyMH0.G-_fLzcpvPla3dUYNCV7qh0j-JHo1Ahr5fS7fQkHdpw");

    let accounts = [];
    let selectedCategory = '';
    let selectedDomain = '';

    async function loadAccounts() {
      const { data, error } = await supabase.from("accounts").select("*").order("created_at", { ascending: false });
      if (error) return console.error(error);
      accounts = data;
      renderFilters();
      renderAccounts();
    }

    function renderFilters() {
      const catSet = [...new Set(accounts.map(a => a.category || ""))];
      const domainSet = [...new Set(accounts.map(a => a.domain || ""))];

      const catArea = document.getElementById("categoryFilters");
      catArea.innerHTML = '';
      catSet.forEach(cat => {
        const chip = document.createElement("div");
        chip.className = `chip ${selectedCategory === cat ? 'active' : ''}`;
        chip.innerText = cat || "(à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸)";
        chip.onclick = () => {
          selectedCategory = selectedCategory === cat ? '' : cat;
          renderAccounts();
          renderFilters();
        };
        catArea.appendChild(chip);
      });

      const domainArea = document.getElementById("domainFilters");
      domainArea.innerHTML = '';
      domainSet.forEach(dom => {
        const chip = document.createElement("div");
        chip.className = `chip ${selectedDomain === dom ? 'active' : ''}`;
        chip.innerText = dom || "(à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸)";
        chip.onclick = () => {
          selectedDomain = selectedDomain === dom ? '' : dom;
          renderAccounts();
          renderFilters();
        };
        domainArea.appendChild(chip);
      });
    }

    function renderAccounts() {
      const keyword = document.getElementById("searchInput").value.toLowerCase();
      const area = document.getElementById("accountList");
      area.innerHTML = '';
      accounts
        .filter(a => (!selectedCategory || a.category === selectedCategory))
        .filter(a => (!selectedDomain || a.domain === selectedDomain))
        .filter(a => (
          (a.account_name || "").toLowerCase().includes(keyword) ||
          (a.description || "").toLowerCase().includes(keyword) ||
          (a.domain || "").toLowerCase().includes(keyword)
        ))
        .forEach(a => {
          const card = document.createElement("div");
          card.className = `card ${a.status === 'inactive' ? 'inactive' : ''}`;
          card.innerHTML = `
            <strong>ğŸŒ ${a.domain}</strong><br/>
            ğŸ·ï¸ ${a.category || "-"}<br/>
            ğŸ†” ${a.account_id}<br/>
            ğŸ”‘ ${a.password}<br/>
            ğŸ“› ${a.account_name}<br/>
            ğŸ“ ${a.description}<br/>
            ğŸ“¶ Status: ${a.status}
          `;
          area.appendChild(card);
        });
    }

    async function addAccount() {
      const domain = document.getElementById("domainInput").value.trim();
      const category = document.getElementById("categoryInput").value.trim();
      const account_id = document.getElementById("idInput").value.trim();
      const password = document.getElementById("passInput").value.trim();
      const account_name = document.getElementById("nameInput").value.trim();
      const description = document.getElementById("descInput").value.trim();
      const status = document.getElementById("statusInput").value;

      if (!domain || !account_id || !password) return alert("à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸³à¸„à¸±à¸");

      const { data, error } = await supabase.from("accounts").insert([
        { domain, category, account_id, password, account_name, description, status }
      ]);
      if (error) return alert("âŒ à¸šà¸±à¸™à¸—à¸¶à¸à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§");

      ["domainInput", "categoryInput", "idInput", "passInput", "nameInput", "descInput"].forEach(id => document.getElementById(id).value = "");
      loadAccounts();
    }

    function filterAccounts() {
      renderAccounts();
    }

    loadAccounts();
  </script>

</body>
</html>
