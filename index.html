<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simple Upload Log</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/index.min.js"></script>
  <style>
    body { font-family: sans-serif; background: #f0f2f5; padding: 2rem; max-width: 600px; margin: auto; }
    .card { background: white; border-radius: 12px; padding: 1rem; margin-bottom: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .timestamp { color: #888; font-size: 0.9rem; }
    .note { margin-top: 0.5rem; }
    .preview-img { max-width: 100%; border-radius: 8px; margin-top: 0.5rem; }
  </style>
</head>
<body>

  <h2>ğŸ“¤ Upload File Log</h2>
  <div class="card">
    <input type="file" id="fileInput" /><br><br>
    <textarea id="noteInput" rows="3" placeholder="à¹€à¸‚à¸µà¸¢à¸™à¹‚à¸™à¹‰à¸•à¹€à¸à¸µà¹ˆà¸¢à¸§à¸à¸±à¸šà¹„à¸Ÿà¸¥à¹Œà¸™à¸µà¹‰..." style="width: 100%;"></textarea><br><br>
    <button onclick="upload()">Upload</button>
  </div>

  <h3>ğŸ“ Uploaded Logs</h3>
  <div id="logArea"></div>





  

  <script>
Â  Â  const supabaseUrl = 'https://fkntlawaawawiusmjsez.supabase.co';
Â  Â  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZrbnRsYXdhYXdhd2l1c21qc2V6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk5ODcxMjAsImV4cCI6MjA2NTU2MzEyMH0.G-_fLzcpvPla3dUYNCV7qh0j-JHo1Ahr5fS7fQkHdpw';
Â  Â  const client = supabase.createClient(supabaseUrl, supabaseKey);

Â  Â  const logArea = document.getElementById("logArea");

Â  Â  async function loadUploads() {
Â  Â  Â  const { data, error } = await client
Â  Â  Â  Â  .from('uploads')
Â  Â  Â  Â  .select('*')
Â  Â  Â  Â  .order('created_at', { ascending: false });

Â  Â  Â  if (error) return console.error(error);
Â  Â  Â  logArea.innerHTML = '';
Â  Â  Â  data.forEach(renderItem);
Â  Â  }

Â  Â  function renderItem(item) {
Â  Â  Â  const card = document.createElement("div");
Â  Â  Â  card.className = "card";
Â  Â  Â  card.innerHTML = `
Â  Â  Â  Â  <div><strong>${item.file_name}</strong></div>
Â  Â  Â  Â  <div class="note">ğŸ“ ${item.note}</div>
Â  Â  Â  Â  <img src="${item.file_url}" class="preview-img" />
Â  Â  Â  Â  <div class="timestamp">ğŸ“… ${new Date(item.created_at).toLocaleString()}</div>
Â  Â  Â  `;
Â  Â  Â  logArea.appendChild(card);
Â  Â  }

Â  Â  async function upload() {
Â  Â  Â  const file = document.getElementById("fileInput").files[0];
Â  Â  Â  const note = document.getElementById("noteInput").value;
Â  Â  Â  if (!file) return alert("à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¹„à¸Ÿà¸¥à¹Œ");

Â  Â  Â  const path = `${Date.now()}_${file.name}`;

Â  Â  Â  // ğŸ“¦ Upload à¹„à¸›à¸—à¸µà¹ˆ bucket
Â  Â  Â  const { data: uploadData, error: uploadError } = await client
Â  Â  Â  Â  .storage
Â  Â  Â  Â  .from('uploads')
Â  Â  Â  Â  .upload(path, file);
Â  Â  Â  if (uploadError) return console.error("âŒ Upload Error:", uploadError);

Â  Â  Â  // ğŸŒ Get Public URL
Â  Â  Â  const { publicURL, error: urlError } = client
Â        .storage
Â        .from('uploads')
Â        .getPublicUrl(path);
      if (urlError) return console.error("âŒ URL Error:", urlError);

      const publicUrl = publicURL;

Â  Â  Â  console.log("ğŸ“¸ File URL =", publicUrl);

Â  Â  Â  // ğŸ“ Insert à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸‚à¹‰à¸² Table
Â  Â  Â  const { data, error: insertError } = await client
Â  Â  Â  Â  .from('uploads')
Â  Â  Â  Â  .insert({
Â  Â  Â  Â  Â  file_name: file.name,
Â  Â  Â  Â  Â  file_url: publicUrl,
Â  Â  Â  Â  Â  note
Â  Â  Â  Â  });
Â  Â  Â  if (insertError) return console.error("âŒ Insert Error:", insertError);

Â  Â  Â  // ğŸ§¹ Clear form + reload
Â  Â  Â  document.getElementById("fileInput").value = "";
Â  Â  Â  document.getElementById("noteInput").value = "";
Â  Â  Â  loadUploads();
Â  Â  }

Â  Â  loadUploads();
Â  </script>

</body>
</html>
