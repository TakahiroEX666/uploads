<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Account Detail</title>
  <style>
    body {
      font-family: sans-serif;
      background: #ddd;
      margin: 0;
      padding: 2rem 1rem;
    }
    .card {
      background: white;
      border-radius: 16px;
      padding: 1.5rem;
      max-width: 420px;
      margin: auto;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    h2 {
      margin: 0 0 1rem;
    }
    .circle {
      width: 64px;
      height: 64px;
      background: #00ffe3;
      border-radius: 50%;
      margin-bottom: 1rem;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 1rem;
    }
    input, textarea, select {
      width: 100%;
      padding: 0.6rem;
      border-radius: 10px;
      border: 1px solid #aaa;
      margin-top: 0.3rem;
    }
    button {
      margin-top: 1.5rem;
      padding: 0.7rem 1rem;
      background: limegreen;
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
    }
    .delete {
      background: crimson;
      margin-top: 0.5rem;
    }
    .back {
      margin-bottom: 1rem;
      display: block;
      text-align: center;
      color: #444;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <a href="index.html" class="back">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö</a>
  <div class="card">
    <div class="circle"></div>
    <form onsubmit="saveAccount(); return false;">
      <label>üåê Domain</label>
      <input id="domain">

      <label>üÜî Account ID</label>
      <input id="account_id" disabled>

      <label>üîë Password</label>
      <input id="password">

      <label>üìõ Account Name</label>
      <input id="account_name">

      <label>üè∑Ô∏è Category</label>
      <input id="category">

      <label>‚≠ê Important</label>
      <input id="important">

      <label>üìù Description</label>
      <textarea id="description" rows="3"></textarea>

      <label>üì∂ Status</label>
      <select id="status">
        <option value="active">üü¢ ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
        <option value="inactive">üî¥ ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
      </select>

      <button type="submit">üíæ Edit</button>
      <button type="button" class="delete" onclick="deleteAccount()">üóëÔ∏è Delete</button>
    </form>
  </div>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const supabase = createClient(
      "https://fkntlawaawawiusmjsez.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZrbnRsYXdhYXdhd2l1c21qc2V6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk5ODcxMjAsImV4cCI6MjA2NTU2MzEyMH0.G-_fLzcpvPla3dUYNCV7qh0j-JHo1Ahr5fS7fQkHdpw"
    );

    const isEditMode = !!data.account_id;
       if (!isEditMode) {
          document.getElementById('account_id').disabled = false; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà ‚Üí ‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏Å ID ‡πÑ‡∏î‡πâ
      }

    const data = JSON.parse(localStorage.getItem('selectedAccount') || '{}');
    document.getElementById('domain').value = data.domain || '';
    document.getElementById('account_id').value = data.account_id || '';
    document.getElementById('password').value = data.password || '';
    document.getElementById('account_name').value = data.account_name || '';
    document.getElementById('category').value = data.category || '';
    document.getElementById('important').value = data.important || '';
    document.getElementById('description').value = data.description || '';
    document.getElementById('status').value = data.status || 'active';

    window.saveAccount = async function () {

      if (isEditMode) {
  const { error } = await supabase.from('accounts').update(updateData).eq('account_id', data.account_id);
  if (error) return alert('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ' + error.message);
  alert('‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
} else {
  updateData.account_id = document.getElementById('account_id').value.trim();
  const { error } = await supabase.from('accounts').insert([updateData]);
  if (error) return alert('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÑ‡∏î‡πâ: ' + error.message);
  alert('‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
      }
      
      const updateData = {
        domain: document.getElementById('domain').value.trim(),
        password: document.getElementById('password').value.trim(),
        account_name: document.getElementById('account_name').value.trim(),
        category: document.getElementById('category').value.trim(),
        description: document.getElementById('description').value.trim(),
        important: document.getElementById('important').value.trim(),
        status: document.getElementById('status').value,
      };
      const { error } = await supabase.from('accounts').update(updateData).eq('account_id', data.account_id);
      if (error) return alert('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ' + error.message);
      alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
      window.location.href = 'index.html';
    }

    window.deleteAccount = async function () {
      if (!confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
      const { error } = await supabase.from('accounts').delete().eq('account_id', data.account_id);
      if (error) return alert('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ' + error.message);
      alert('‚úÖ ‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
      window.location.href = 'index.html';
    }
  </script>
</body>
</html>
